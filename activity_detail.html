<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>詳細 — 学術/社会貢献/委員</title>
<style>
:root{--brand:#e60033;--ink:#222;--muted:#666;--line:#e8e8e8;--bg:#f6f7f8;--card:#fff;--shadow:0 8px 24px rgba(0,0,0,.06)}
*{box-sizing:border-box}html,body{margin:0}
body{background:var(--bg);color:var(--ink);font:14px/1.65 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:0 14px}
header.site{position:sticky;top:0;z-index:60;background:#fff;border-bottom:1px solid var(--line)}
.header-inner{display:flex;align-items:center;gap:12px;padding:10px 0}
.logo{display:flex;align-items:center;gap:10px;font-weight:900;color:var(--brand)}
.logo-mark{width:24px;height:24px;border-radius:6px;background:linear-gradient(135deg,#ff4a6e,var(--brand))}
.actions{display:flex;gap:8px;flex-wrap:wrap}.btn{height:34px;padding:0 12px;border:1px solid var(--line);border-radius:8px;background:#fff;cursor:pointer}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
main.container{margin:16px auto}
/* layout */
.hero{background:#fff;border:1px solid var(--line);box-shadow:var(--shadow);border-radius:10px;overflow:hidden}
.hero-inner{display:grid;grid-template-columns:420px 1fr;gap:16px}
@media (max-width:980px){.hero-inner{grid-template-columns:1fr}}
.cover{position:relative;background:#f4f4f4;aspect-ratio:3/4;display:grid;place-items:center}
.cover img{width:100%;height:100%;object-fit:cover}
.meta{padding:12px;display:grid;gap:8px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#fff;font-size:.86rem;color:#555}
.title{font-weight:900;font-size:1.2rem}
.sub{color:#666}
.ops{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.ops .btn{height:36px}
.specs{margin-top:10px;border-top:1px dashed var(--line);padding-top:10px}
.specs h3{margin:0 0 8px;font-size:1rem}
.specgrid{display:grid;grid-template-columns:160px 1fr;gap:8px;align-items:flex-start}
.speck{color:#777}
.specv{white-space:pre-wrap}
.note{margin-top:8px;background:#fff;border:1px solid var(--line);border-radius:8px;padding:10px}
.note h4{margin:0 0 6px;font-size:1rem}
.footer-links{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:10px 0}
.footer-links .sep{color:#bbb}
footer{margin-top:26px;background:#fff;border-top:1px solid var(--line)}
.copyright{border-top:1px solid var(--line);color:#777;padding:12px 0;font-size:.88rem}
.small{font-size:.9rem;color:#777}

.admin-only { display:none !important; }
.is-admin .admin-only { display: initial !important; }
.is-admin .admin-only.block { display:block !important; }
</style>
</head>
<body>
<header class="site">
  <div class="container header-inner">
    <a class="logo" href="index.html"><span class="logo-mark"></span><span>長峰実央</span></a>
    <div class="actions" style="margin-left:auto">
      <a class="btn" href="history.html">履歴</a>
      <a class="btn" href="units.html">取得単位</a>
      <a class="btn primary" href="comments.html">論文のコメント</a>
    </div>
  </div>

  
</header>

<main class="container">
  <div id="breadcrumb" class="small"><a href="index.html">ホーム</a> › <a href="history.html">履歴</a> › 詳細</div>
  <section class="hero" style="margin-top:10px">
    <div class="hero-inner">
      <div class="cover" id="cover">PHOTO</div>
      <div class="meta">
        <div><span class="badge" id="badge-type">種別</span></div>
        <div class="title" id="title">タイトル</div>
        <div class="sub" id="subline">——</div>
        <div class="ops">
          <a class="btn primary" id="btn-open" href="#" target="_blank" rel="noopener">リンクを開く</a>
          <button class="btn admin-only" id="btn-edit">編集</button>
          <a class="btn" href="history.html">一覧へ戻る</a>
        </div>
        <div class="specs">
          <h3>スペック</h3>
          <div class="specgrid" id="specgrid"></div>
          <div class="ops" style="margin-top:6px">
            <button class="btn admin-only" id="btn-addspec">＋ スペック行を追加</button>
          </div>
        </div>
        <div class="note" id="note-box" style="display:none">
          <h4>メモ</h4>
          <div id="note"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="container footer-links" id="footer-links"></div>
  <div class="container copyright">© 2025 Mao Nagamine</div>
</footer>

<script>
// ===== 共通フッター =====
const FOOTER_LINKS=[
  {label:'ホーム',href:'index.html'},
  {label:'履歴',href:'history.html'},
  {label:'取得単位',href:'units.html'},
  {label:'コメント',href:'comments.html'},
  {label:'お問い合わせ',href:'mailto:nagamine.mao.d9@elms.hokudai.ac.jp'}
];
function renderFooter(){
  const box=document.getElementById('footer-links'); if(!box) return;
  box.innerHTML = FOOTER_LINKS.map((x,i)=>`
    <a href="${x.href}" ${x.target?`target="${x.target}" rel="noopener"`:''}>${x.label}</a>
    ${i<FOOTER_LINKS.length-1?'<span class="sep">/</span>':''}
  `).join('');
}
document.addEventListener('DOMContentLoaded', renderFooter);

// ===== データ読み込み =====
const LS='hist_items_v7';
const load=()=>JSON.parse(localStorage.getItem(LS)||'[]');
function qs(k){return new URLSearchParams(location.search).get(k)||'';}
const id = qs('id');

function dispType(t){return ({academic:'学術貢献活動',social:'社会貢献活動',committee:'委員'})[t]||t||'—';}
function setSpec(key, value){
  const grid=document.getElementById('specgrid');
  const row=document.createElement('div');
  row.className='specrow';
  row.innerHTML = `<div class="speck">${key}</div><div class="specv">${value||'—'}</div>`;
  grid.appendChild(row);
}

function render(){
  const items=load();
  const it = items.find(x=>x.id===id);
  if(!it){
    document.querySelector('main').innerHTML = `
      <div class="hero" style="padding:16px">
        <p>このIDのデータが見つかりません。履歴ページから開き直してください。</p>
        <p><a class="btn" href="history.html">← 履歴へ戻る</a></p>
      </div>`;
    return;
  }
  // カバー
  const cover=document.getElementById('cover');
  cover.innerHTML = it.thumb ? `<img src="${it.thumb}" alt="">` : 'PHOTO';
  // 基本
  document.getElementById('badge-type').textContent = dispType(it.type);
  document.getElementById('title').textContent = it.title||'';
  document.getElementById('subline').textContent = [it.date||'', it.venue||'', it.loc?('＠'+it.loc):''].filter(Boolean).join(' ｜ ') || '—';
  // 外部リンク
  const btn = document.getElementById('btn-open');
  if(it.url){ btn.href = it.url; btn.style.display='inline-block'; }
  else { btn.style.display='none'; }
  // スペック（基本＋自由）
  const grid=document.getElementById('specgrid'); grid.innerHTML='';
  setSpec('カテゴリ', dispType(it.type));
  setSpec('日付/期間', it.date||'');
  setSpec('主催/媒体/学会', it.venue||'');
  setSpec('場所', it.loc||'');
  setSpec('リンク', it.url?`<a href="${it.url}" target="_blank" rel="noopener">${it.url}</a>`:'');
  const specs = Array.isArray(it.specs)? it.specs: [];
  specs.forEach((line,i)=> setSpec(`追加${i+1}`, line));
  // メモ
  const noteBox=document.getElementById('note-box');
  if(it.note){ document.getElementById('note').textContent = it.note; noteBox.style.display='block'; }
  else{ noteBox.style.display='none'; }

  // 編集
  document.getElementById('btn-edit').onclick = ()=>{
    const type = prompt('カテゴリ（academic / social / committee）', it.type||'academic'); if(type===null) return;
    const title= prompt('タイトル', it.title||''); if(title===null) return;
    const date = prompt('日付/期間', it.date||''); if(date===null) return;
    const venue= prompt('主催/媒体/学会', it.venue||''); if(venue===null) return;
    const loc  = prompt('場所（任意）', it.loc||''); if(loc===null) return;
    const url  = prompt('URL（任意）', it.url||''); if(url===null) return;
    const thumb= prompt('写真URL（任意）', it.thumb||''); if(thumb===null) return;
    const note = prompt('メモ（任意）', it.note||''); if(note===null) return;
    Object.assign(it,{type,title,date,venue,loc,url,thumb,note});
    localStorage.setItem(LS, JSON.stringify(items));
    render();
  };

  // スペック行の追加
  document.getElementById('btn-addspec').onclick = ()=>{
    const v = prompt('スペック行（例：役割：実行委員 / 担当：企画 等）'); if(v===null) return;
    const arr = Array.isArray(it.specs)?it.specs: (it.specs=[]);
    arr.push(v);
    localStorage.setItem(LS, JSON.stringify(items));
    render();
  };
}
document.addEventListener('DOMContentLoaded', render);
</script>

<script>
(function(){
  const p=new URLSearchParams(location.search);
  const isLocal = ['localhost','127.0.0.1'].includes(location.hostname)
               || location.protocol==='file:'
               || p.get('admin')==='1'
               || localStorage.getItem('admin')==='1';
  if(isLocal) document.documentElement.classList.add('is-admin');
  // Ctrl+Shift+E で切替
  addEventListener('keydown',e=>{
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='e'){
      const on=localStorage.getItem('admin')==='1';
      localStorage.setItem('admin', on?'0':'1'); location.reload();
    }
  });
})();
</script>

</body>
</html>
